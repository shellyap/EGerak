<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Realtime Sync App</title>
</head>
<body>
  <h1>Realtime Sync App</h1>
  <textarea id="editor" style="width:100%;height:200px;"></textarea>

  <script type="module">
    import { initRealtime, startRealtimeSync } from "./realtime-sync.js";

    // === YOUR FIREBASE CONFIG (working + valid) ===
    const firebaseConfig = {
      apiKey: "AIzaSyBU1n6OAmYxY_SjFuhYkop7C7CrFJja6Do",
      authDomain: "egerak-4f922.firebaseapp.com",
      projectId: "egerak-4f922",
      storageBucket: "egerak-4f922.firebasestorage.app",
      messagingSenderId: "567427021114",
      appId: "1:567427021114:web:cf5496d2fc14eb84893803",
      measurementId: "G-V6CGGJ81JG"
    };

    // Initialize realtime sync engine
    await initRealtime(firebaseConfig);

    const editor = document.getElementById("editor");

    // Start syncing text area with Firestore realtime
    const sync = startRealtimeSync({
      docPath: "documents/demo",
      getLocal: () => ({ text: editor.value }),
      applyRemote: (remote) => {
        if (remote.text !== editor.value) {
          editor.value = remote.text;
        }
      }
    });

    // Push changes on typing
    editor.addEventListener("input", () => {
      sync.pushLocalChange({ text: editor.value }, { author: "user" });
    });
  </script>
</body>
</html>
